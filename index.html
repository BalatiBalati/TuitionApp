<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tutoring Courses</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Bubblegum+Sans&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="products.js"></script>
    <script src="https://unpkg.com/vue@2.7.8/dist/vue.js"></script>
</head>

<body>
    <div id="app">
        <header>
            <div class="site-name" v-text="sitename"></div>
            <nav>
                <ul>
                    <li>
                        <button v-on:click="showCheckoutModal">
                            {{ cartItemCount }} <span class="fas fa-cart-plus"></span> Checkout
                        </button>
                    </li>
                    <li><button v-on:click="showLoginModal">Log In</button></li>
                    <li><button v-on:click="showSignupModal">Sign Up</button></li>
                </ul>
            </nav>
        </header>
        
        <main>
            <div class="content" v-if="!showCheckoutOptions">
                <section class="course-section" v-for="course in courses" :key="course.id">
                    <figure>
                        <img v-bind:src="course.image" alt="Course Image" />
                    </figure>
                    <h2 v-text="course.title"></h2>
                    <p v-text="course.description"></p>
                    <p>Price: ${{ course.price }}</p>
                    <p>Teacher: {{ course.teacher }}</p>

                    <!-- Rating Section -->
                    <div class="rating">
                        <span 
                            v-for="n in 5" 
                            :key="n" 
                            class="fas fa-star" 
                            :class="{'filled': n <= course.rating}"
                            title="Rating"
                        ></span>
                    </div>

                    <!-- Available Inventory Section -->
                    <div class="inventory">
                        <p>Available Seats: <span v-bind:class="{'out-of-stock': course.availableSeats <= 0}">{{ course.availableSeats }}</span></p>
                    </div>

                    <button v-on:click="addToCart(course)" v-if="course.availableSeats > 0">Add to Cart</button>
                    <button disabled v-else>Out of stock</button>
                </section>
            </div>

            <!-- Checkout Modal -->
            <div v-if="showCheckoutOptions" class="modal">
                <div class="modal-content">
                    <span class="close" v-on:click="closeCheckoutModal">&times;</span>
                    <h2>Checkout</h2>
                    <p>
                        <strong>Firstname: </strong>
                        <input v-model.trim="order.firstName" />
                    </p>
                    <p>
                        <strong>Lastname: </strong>
                        <input v-model.trim="order.lastName" />
                    </p>
                    <p>
                        <strong>Address: </strong> 
                        <input v-model.trim="order.address" />
                    </p>
                    <p>
                        <strong>City: </strong> 
                        <input v-model.trim="order.city" />
                    </p>
                    <p>
                        <strong>State: </strong>
                        <select v-model="order.state">
                            <option disabled value="">State</option>
                            <option v-for="(state, key) in states" v-bind:value="key">
                                {{ state }}
                            </option>
                        </select>
                    </p>
                    <p>
                        <strong>Zip/Postal Code: </strong> <input v-model.number="order.zip" />
                    </p>
                    <p>
                        <input type="checkbox" id="gift" v-model="order.gift" />
                        <label for="gift">Ship As Gift?</label>
                    </p>
                    <p>
                        <input type="radio" id="home" value="Home" v-model="order.method" />
                        <label for="home">Home</label>
                        <input type="radio" id="business" value="Business" v-model="order.method" />
                        <label for="business">Business</label>
                    </p>
                    <h2>Order Information</h2>
                    <p>Firstname: {{ order.firstName }}</p>
                    <p>Lastname: {{ order.lastName }}</p>
                    <p>Address: {{ order.address }}</p>
                    <p>City: {{ order.city }}</p>
                    <p>Zip: {{ order.zip }}</p>
                    <p>State: {{ order.state }}</p>
                    <button v-on:click="submitForm">Place Order</button>
                </div>
            </div>

            <!-- Modal for Login -->
            <div v-if="showLogin" class="modal">
                <div class="modal-content">
                    <span class="close" v-on:click="showLogin = false">&times;</span>
                    <h2>Log In</h2>
                    <input type="text" placeholder="Email" v-model="loginEmail" />
                    <input type="password" placeholder="Password" v-model="loginPassword" />
                    <button v-on:click="login">Log In</button>
                </div>
            </div>

            <!-- Modal for Sign Up -->
            <div v-if="showSignup" class="modal">
                <div class="modal-content">
                    <span class="close" v-on:click="showSignup = false">&times;</span>
                    <h2>Sign Up</h2>
                    <input type="text" placeholder="Username" v-model="signupUsername" />
                    <input type="text" placeholder="Email" v-model="signupEmail" />
                    <input type="password" placeholder="Password" v-model="signupPassword" />
                    <button v-on:click="signup">Sign Up</button>
                </div>
            </div>
        </main>
    </div>

    <script type="text/javascript">
        let webstore = new Vue({
            el: '#app',
            data: {
                sitename: 'Extra Tuition Courses',
                showProduct: true,
                //products: [],

                cart: [],
                showLoginModal: false,
                showSignupModal: false,
                showCheckoutOptions: false,
                showLogin: false,
                showSignup: false,
                order: {
                    firstName: '',
                    lastName: '',
                    address: '',
                    city: '',
                    state: '',
                    zip: '',
                    method: '',
                    gift: false
                }
            },
            created: function(){
                fetch("http://localhost:3001/collections/products").then(
                    function(response){
                        response.json().then(
                            function(json){
                                webstore.courses = json;
                            }
                        )
                    }
                )
            },
            methods: {
                addToCart(course) {
                    this.cart.push(course);
                    alert(`${course.title} added to cart!`);
                },
                closeCheckoutModal() {
                    this.showCheckoutOptions = false;
                },
                showCheckoutModal() {
                    this.showCheckoutOptions = true;
                },
                submitForm() {
                    alert("Order placed successfully!");
                    this.showCheckoutOptions = false;
                },
                showLoginModal() {
                    this.showLoginModal = true;
                },
                showSignupModal() {
                    this.showSignupModal = true;
                },
                signup() {
                    alert(`Signed up as ${this.signupEmail}`);
                    this.showSignup = false;
                }
            },
            computed: {
                cartItemCount() {
                    return this.cart.length;
                }
            }
        });
    </script>
</body>
</html>
